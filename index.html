function gerarRelatorio(){

  let lista = JSON.parse(localStorage.getItem("presencas_diarias") || "[]");

  if(lista.length === 0){
    alert("Não há dados para gerar relatório.");
    return;
  }

  // pega mês/ano do primeiro registro
  const primeiraData = lista[0].dataISO;
  const [ano, mes] = primeiraData.split("-");

  const nomesMes = {
    "01":"Janeiro","02":"Fevereiro","03":"Março","04":"Abril",
    "05":"Maio","06":"Junho","07":"Julho","08":"Agosto",
    "09":"Setembro","10":"Outubro","11":"Novembro","12":"Dezembro"
  };

  const mesNome = nomesMes[mes];

  // monta tabela
  let linhas = "";

  lista.forEach(r=>{
    linhas += `
      <tr>
        <td>${r.dataBR}</td>
        <td>${r.pessoas.join(", ")}</td>
      </tr>
    `;
  });

  // abrir nova janela com relatório bonito
  const relatorio = `
  <html>
  <head>
    <title>Relatório Ferroport</title>
    <style>
      body{
        font-family:Arial;
        padding:40px;
      }

      .topo{
        display:flex;
        align-items:center;
        gap:20px;
        margin-bottom:30px;
      }

      .logo{
        height:70px;
      }

      h1{
        margin:0;
      }

      table{
        width:100%;
        border-collapse:collapse;
        margin-top:20px;
      }

      th, td{
        border:1px solid #ccc;
        padding:10px;
        text-align:center;
      }

      th{
        background:#f0f0f0;
      }

      .rodape{
        margin-top:30px;
        text-align:center;
        color:#666;
      }

    </style>
  </head>

  <body>

    <div class="topo">
      <img src="logo-digital.png" class="logo">
      <img src="logo-emive.png" class="logo">
      <div>
        <h1>Relatório Mensal de Presença</h1>
        <p>Contrato Ferroport</p>
        <p><strong>${mesNome} / ${ano}</strong></p>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Data</th>
          <th>Técnicos presentes</th>
        </tr>
      </thead>
      <tbody>
        ${linhas}
      </tbody>
    </table>

    <div class="rodape">
      DIGITAL • EMIVE<br>
      Tecnologia e Segurança
    </div>

  </body>
  </html>
  `;

  const janela = window.open("", "_blank");
  janela.document.write(relatorio);
  janela.document.close();
}
